<!DOCTYPE html>  <html> <head>   <title>stackscraper.user.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               stackscraper.user.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="o">`</span><span class="err">// ==UserScript==</span>
<span class="o">/</span><span class="err">/ @name           StackScraper</span>
<span class="o">/</span><span class="err">/ @version        0.3.0</span>
<span class="o">/</span><span class="sr">/ @namespace      http:/</span><span class="o">/</span><span class="nx">extensions</span><span class="p">.</span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="sr">/stackscraper/</span>
<span class="o">/</span><span class="err">/ @description    Adds download options to Stack Exchange questions.</span>
<span class="o">/</span><span class="sr">/ @include        *:/</span><span class="o">/*</span><span class="p">.</span><span class="nx">stackexchange</span><span class="p">.</span><span class="nx">com</span><span class="sr">/questions/</span><span class="o">*</span>
<span class="err">// @include        *://stackoverflow.com/questions/*</span>
<span class="o">/</span><span class="sr">/ @include        *:/</span><span class="o">/*</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">com</span><span class="sr">/questions/</span><span class="o">*</span>
<span class="err">// @include        *://superuser.com/questions/*</span>
<span class="o">/</span><span class="sr">/ @include        *:/</span><span class="o">/*</span><span class="p">.</span><span class="nx">superuser</span><span class="p">.</span><span class="nx">com</span><span class="sr">/questions/</span><span class="o">*</span>
<span class="err">// @include        *://serverfault.com/questions/*</span>
<span class="o">/</span><span class="sr">/ @include        *:/</span><span class="o">/*</span><span class="p">.</span><span class="nx">serverfault</span><span class="p">.</span><span class="nx">com</span><span class="sr">/questions/</span><span class="o">*</span>
<span class="err">// @include        *://stackapps.com/questions/*</span>
<span class="o">/</span><span class="sr">/ @include        *:/</span><span class="o">/*</span><span class="p">.</span><span class="nx">stackapps</span><span class="p">.</span><span class="nx">com</span><span class="sr">/questions/</span><span class="o">*</span>
<span class="err">// @include        *://askubuntu.com/questions/*</span>
<span class="o">/</span><span class="sr">/ @include        *:/</span><span class="o">/*</span><span class="p">.</span><span class="nx">askubuntu</span><span class="p">.</span><span class="nx">com</span><span class="sr">/questions/</span><span class="o">*</span>
<span class="err">// @include        *://answers.onstartups.com/questions/*</span>
<span class="o">/</span><span class="sr">/ @include        *:/</span><span class="o">/*</span><span class="p">.</span><span class="nx">answers</span><span class="p">.</span><span class="nx">onstartups</span><span class="p">.</span><span class="nx">com</span><span class="sr">/questions/</span><span class="o">*</span>
<span class="err">// ==/UserScript==</span>
<span class="o">`</span>

<span class="nv">manifest = </span>
  <span class="nv">name: </span><span class="s1">&#39;StackScraper&#39;</span>
  <span class="nv">version: </span><span class="s1">&#39;0.3.0&#39;</span>
  <span class="nv">description: </span><span class="s1">&#39;Adds download options to Stack Exchange questions.&#39;</span>
  <span class="nv">homepage_url: </span><span class="s1">&#39;http://stackapps.com/questions/3211/stackscraper-export-questions-as-json-or-html&#39;</span>
  <span class="nv">permissions: </span><span class="p">[</span>
    <span class="s1">&#39;*://*.stackexchange.com/*&#39;</span>
    <span class="s1">&#39;*://*.stackoverflow.com/*&#39;</span>
    <span class="s1">&#39;*://*.serverfault.com/*&#39;</span>
    <span class="s1">&#39;*://*.superuser.com/*&#39;</span>
    <span class="s1">&#39;*://*.askubuntu.com/*&#39;</span>
    <span class="s1">&#39;*://*.answers.onstartups.com/*&#39;</span>
    <span class="s1">&#39;*://*.stackapps.com/*&#39;</span>
  <span class="p">]</span>
  <span class="nv">content_scripts: </span><span class="p">[</span><span class="nv">matches: </span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="nv">js: </span><span class="p">[</span><span class="s1">&#39;stackscraper.user.js&#39;</span><span class="p">]]</span>
  <span class="nv">icons: </span><span class="mi">128</span><span class="o">:</span> <span class="s1">&#39;icon128.png&#39;</span>

<span class="nv">body = </span><span class="nf">(manifest) -&gt;</span>
  <span class="o">`</span><span class="nv">__slice = </span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="o">`</span> <span class="c1"># include this manually because we break CoffeeScript&#39;s copy</span>
  <span class="nv">BlobBuilder = </span><span class="nx">@BlobBuilder</span> <span class="o">or</span> <span class="nx">@WebKitBlobBuilder</span> <span class="o">or</span> <span class="nx">@MozBlobBuilder</span> <span class="o">or</span> <span class="nx">@OBlobBuilder</span>
  <span class="nv">URL = </span><span class="nx">@URL</span> <span class="o">or</span> <span class="nx">@webkitURL</span> <span class="o">or</span> <span class="nx">@mozURL</span> <span class="o">or</span> <span class="nx">@oURL</span>
  
  <span class="nv">main = </span><span class="o">-&gt;</span>
    <span class="vi">@stackScraper = </span><span class="nv">stackScraper = </span><span class="k">new</span> <span class="nx">StackScraper</span>
    <span class="nv">questionId = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#question&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;questionid&#39;</span><span class="p">)</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#question .post-menu&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;span class=&quot;lsep&quot;&gt;|&lt;/span&gt;&#39;</span><span class="p">).</span><span class="nx">append</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;#&quot; title=&quot;download a JSON copy of this post&quot;&gt;json&lt;/a&gt;&#39;</span><span class="p">).</span><span class="nx">click</span> <span class="o">-&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="p">).</span><span class="nx">addClass</span> <span class="s1">&#39;ac_loading&#39;</span>
      <span class="nx">stackScraper</span><span class="p">.</span><span class="nx">getQuestion</span><span class="p">(</span><span class="nx">questionId</span><span class="p">).</span><span class="k">then</span> <span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nv">bb = </span><span class="k">new</span> <span class="nx">BlobBuilder</span>
        <span class="nx">bb</span><span class="p">.</span><span class="nx">append</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span>
        <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="p">).</span><span class="nx">removeClass</span> <span class="s1">&#39;ac_loading&#39;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nv">location = </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">bb</span><span class="p">.</span><span class="nx">getBlob</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;#question-#{questionId}.json&quot;</span>
    
      <span class="kc">false</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#question .post-menu&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;span class=&quot;lsep&quot;&gt;|&lt;/span&gt;&#39;</span><span class="p">).</span><span class="nx">append</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;#&quot; title=&quot;download an HTML copy of this post&quot;&gt;html&lt;/a&gt;&#39;</span><span class="p">).</span><span class="nx">click</span> <span class="o">-&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">addClass</span> <span class="s1">&#39;ac_loading&#39;</span>
      <span class="nx">stackScraper</span><span class="p">.</span><span class="nx">getQuestion</span><span class="p">(</span><span class="nx">questionId</span><span class="p">).</span><span class="k">then</span> <span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nv">bb = </span><span class="k">new</span> <span class="nx">BlobBuilder</span>
        <span class="nx">bb</span><span class="p">.</span><span class="nx">append</span> <span class="nx">stackScraper</span><span class="p">.</span><span class="nx">renderQuestionPage</span><span class="p">(</span><span class="nx">question</span><span class="p">)</span>
        <span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="p">).</span><span class="nx">removeClass</span> <span class="s1">&#39;ac_loading&#39;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nv">location = </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">bb</span><span class="p">.</span><span class="nx">getBlob</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;#question-#{questionId}.html&quot;</span>
    
      <span class="kc">false</span>
  
  <span class="nv">makeThrottle = </span><span class="nf">(interval) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Creates a throttle with a given interval. the throttle takes a function and wraps it such that it yields
deferred results and the wrapped function won't be called more often than once every interval miliseconds.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">queue = </span><span class="p">[]</span>
    <span class="nv">intervalId = </span><span class="kc">null</span>
    <span class="nv">throttle = </span><span class="nf">(f) -&gt;</span>
      <span class="nv">throttled = </span><span class="o">-&gt;</span>
        <span class="nv">thisVal = </span><span class="k">this</span>
        <span class="nv">argVals = </span><span class="nx">arguments</span>
        <span class="nv">resultP = </span><span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span>
      
        <span class="k">if</span> <span class="nx">intervalId</span><span class="o">?</span>
          <span class="nx">queue</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span><span class="nx">f</span><span class="p">,</span> <span class="nx">thisVal</span><span class="p">,</span> <span class="nx">argVals</span><span class="p">,</span> <span class="nx">resultP</span><span class="p">]</span>
        <span class="k">else</span>
          <span class="nx">$</span><span class="p">.</span><span class="k">when</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">thisVal</span><span class="p">,</span> <span class="nx">argVals</span><span class="p">).</span><span class="k">then</span><span class="p">(</span><span class="nx">resultP</span><span class="p">.</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">resultP</span><span class="p">.</span><span class="nx">reject</span><span class="p">,</span> <span class="nx">resultP</span><span class="p">.</span><span class="nx">notify</span><span class="p">)</span>
          <span class="nv">intervalId = </span><span class="nx">setInterval</span> <span class="o">-&gt;</span>
            <span class="k">if</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">length</span>
              <span class="p">[</span><span class="nx">f_</span><span class="p">,</span> <span class="nx">thisVal_</span><span class="p">,</span> <span class="nx">argVals_</span><span class="p">,</span> <span class="nx">resultP_</span><span class="p">]</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
              <span class="nx">$</span><span class="p">.</span><span class="k">when</span><span class="p">(</span><span class="nx">f_</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">thisVal_</span><span class="p">,</span> <span class="nx">argVals_</span><span class="p">).</span><span class="k">then</span><span class="p">(</span><span class="nx">resultP_</span><span class="p">.</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">resultP_</span><span class="p">.</span><span class="nx">reject</span><span class="p">,</span> <span class="nx">resultP_</span><span class="p">.</span><span class="nx">notify</span><span class="p">)</span>
            <span class="k">else</span>
              <span class="nx">clearInterval</span> <span class="nx">intervalId</span>
              <span class="nv">intervalId = </span><span class="kc">null</span>
          <span class="p">,</span> <span class="nx">interval</span>
      
        <span class="nx">resultP</span>
      <span class="nv">throttled.throttle = </span><span class="nx">throttle</span>
      <span class="nv">throttled.wrapped = </span><span class="nx">f</span>
      <span class="nx">throttled</span>

  <span class="nv">makeDocument = </span><span class="nf">(html, title = &#39;&#39;) -&gt;</span>
    <span class="nv">doc = </span><span class="nb">document</span><span class="p">.</span><span class="nx">implementation</span><span class="p">.</span><span class="nx">createHTMLDocument</span><span class="p">(</span><span class="nx">title</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">html</span><span class="o">?</span> <span class="k">then</span> <span class="nv">doc.head.parentElement.innerHTML = </span><span class="nx">html</span>
    <span class="nx">doc</span>
  
  <span class="k">class</span> <span class="nx">StackScraper</span>
    <span class="nv">constructor: </span><span class="o">-&gt;</span>
      <span class="vi">@questions = </span><span class="p">{}</span>
      <span class="vi">@throttles = </span><span class="p">{}</span>
      
    <span class="nv">getQuestion: </span><span class="nf">(questionid) -&gt;</span>
      <span class="k">if</span> <span class="nx">questionid</span> <span class="k">of</span> <span class="nx">@questions</span>
        <span class="k">return</span> <span class="nx">@questions</span><span class="p">[</span><span class="nx">questionid</span><span class="p">]</span>
      
      <span class="nx">@questions</span><span class="p">[</span><span class="nx">questionid</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@getShallowQuestion</span><span class="p">(</span><span class="nx">questionid</span><span class="p">).</span><span class="nx">pipe</span> <span class="p">(</span><span class="nx">question</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nv">tasks = </span><span class="p">[]</span>
      
        <span class="k">for</span> <span class="nx">post</span> <span class="k">in</span> <span class="p">[</span><span class="nx">question</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">question</span><span class="p">.</span><span class="nx">answers</span><span class="p">)</span>
          <span class="nx">do</span> <span class="p">(</span><span class="nx">post</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="nx">tasks</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@getPostSource</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">post_id</span><span class="p">,</span> <span class="kc">null</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span> <span class="p">(</span><span class="nx">postSource</span><span class="p">)</span> <span class="o">=&gt;</span>
              <span class="nv">post.title_source = </span><span class="nx">postSource</span><span class="p">.</span><span class="nx">title</span>
              <span class="nv">post.body_source = </span><span class="nx">postSource</span><span class="p">.</span><span class="nx">body</span>
              <span class="nx">post</span>
            <span class="p">,</span> <span class="o">-&gt;</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s2">&quot;unable to retrieve source of post #{post.post_id}&quot;</span>
              <span class="p">(</span><span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">).</span><span class="nx">resolve</span><span class="p">()</span>
            <span class="p">)</span>
            
            <span class="nx">tasks</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@getPostComments</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">post_id</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span> <span class="p">(</span><span class="nx">postComments</span><span class="p">)</span> <span class="o">=&gt;</span>
              <span class="nv">post.comments = </span><span class="nx">postComments</span>
              <span class="nx">post</span>
            <span class="p">,</span> <span class="o">-&gt;</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s2">&quot;unable to retrieve comments on post #{post.post_id}&quot;</span>
              <span class="p">(</span><span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">).</span><span class="nx">resolve</span><span class="p">()</span>
            <span class="p">)</span>
            
            <span class="nx">tasks</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@getPostVoteCount</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">post_id</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span> <span class="p">(</span><span class="nx">voteCount</span><span class="p">)</span> <span class="o">=&gt;</span>
              <span class="nv">post.up_votes = </span><span class="nx">voteCount</span><span class="p">.</span><span class="nx">up</span>
              <span class="nv">post.down_votes = </span><span class="nx">voteCount</span><span class="p">.</span><span class="nx">down</span>
              <span class="nx">post</span>
            <span class="p">,</span> <span class="o">-&gt;</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s2">&quot;unable to retrieve vote counts of post #{post.post_id}&quot;</span>
              <span class="p">(</span><span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">).</span><span class="nx">resolve</span><span class="p">()</span>
            <span class="p">)</span>
      
        <span class="nv">questionP = </span><span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span>
      
        <span class="nx">$</span><span class="p">.</span><span class="k">when</span><span class="p">(</span><span class="nx">tasks</span><span class="p">...).</span><span class="k">then</span> <span class="o">=&gt;</span>
          <span class="nx">questionP</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">question</span>
        <span class="p">,</span> <span class="nx">questionP</span><span class="p">.</span><span class="nx">reject</span>
      
        <span class="nx">questionP</span><span class="p">.</span><span class="nx">promise</span><span class="p">()</span>
  
    <span class="nv">getShallowQuestion: </span><span class="nf">(questionid) -&gt;</span>
      <span class="nx">@getQuestionDocuments</span><span class="p">(</span><span class="nx">questionid</span><span class="p">).</span><span class="nx">pipe</span> <span class="nf">(pages) -&gt;</span>
        <span class="nv">question = </span><span class="nx">scrapePostElement</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.question&#39;</span><span class="p">,</span> <span class="nx">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="nv">question.title = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#question-header h1 a&#39;</span><span class="p">,</span> <span class="nx">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">text</span><span class="p">()</span>
        <span class="nv">question.tags = </span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">tag</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span> <span class="k">for</span> <span class="nx">tag</span> <span class="k">in</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.post-taglist .post-tag&#39;</span><span class="p">,</span> <span class="nx">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="nv">question.favorite_count = </span><span class="o">+</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.favoritecount&#39;</span><span class="p">,</span> <span class="nx">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">text</span><span class="p">()</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nv">question.answers = </span><span class="p">[]</span>
        <span class="nv">question.closed = </span><span class="kc">false</span>
        <span class="nv">question.locked = </span><span class="kc">false</span>
        <span class="nv">question.protected = </span><span class="kc">false</span>
        <span class="k">for</span> <span class="nx">status</span> <span class="k">in</span> <span class="nx">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.question-status&#39;</span><span class="p">)</span>
          <span class="nv">type = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="nx">status</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span>
          <span class="k">if</span> <span class="nx">type</span> <span class="o">is</span> <span class="s1">&#39;closed&#39;</span>
            <span class="nv">question.closed = </span><span class="kc">true</span>
            <span class="nv">question.title = </span><span class="nx">question</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\ \[(closed|migrated)\]$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
          <span class="k">if</span> <span class="nx">type</span> <span class="o">is</span> <span class="s1">&#39;locked&#39;</span> <span class="k">then</span> <span class="nv">question.locked = </span><span class="kc">true</span>
          <span class="k">if</span> <span class="nx">type</span> <span class="o">is</span> <span class="s1">&#39;protected&#39;</span> <span class="k">then</span> <span class="nv">question.protected = </span><span class="kc">true</span>
      
        <span class="k">for</span> <span class="nx">row</span> <span class="k">in</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#qinfo tr&#39;</span><span class="p">,</span> <span class="nx">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
          <span class="nv">key = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.label-key&#39;</span><span class="p">,</span> <span class="nx">row</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">text</span><span class="p">()</span>
          <span class="k">if</span> <span class="nx">key</span> <span class="o">is</span> <span class="s1">&#39;asked&#39;</span>
            <span class="nv">question.creation_date_z = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.label-key&#39;</span><span class="p">,</span> <span class="nx">row</span><span class="p">).</span><span class="nx">last</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
          <span class="k">if</span> <span class="nx">key</span> <span class="o">is</span> <span class="s1">&#39;viewed&#39;</span>
            <span class="nv">question.view_count = </span><span class="o">+</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.label-key&#39;</span><span class="p">,</span> <span class="nx">row</span><span class="p">).</span><span class="nx">last</span><span class="p">().</span><span class="nx">text</span><span class="p">()</span><span class="o">?</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
      
        <span class="k">for</span> <span class="nx">page$</span> <span class="k">in</span> <span class="nx">pages</span>
          <span class="k">for</span> <span class="nx">answer</span> <span class="k">in</span> <span class="nx">page$</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.answer&#39;</span><span class="p">)</span>
            <span class="nx">question</span><span class="p">.</span><span class="nx">answers</span><span class="p">.</span><span class="nx">push</span> <span class="nx">scrapePostElement</span> <span class="nx">$</span><span class="p">(</span><span class="nx">answer</span><span class="p">)</span>
      
        <span class="nx">question</span>
  
    <span class="nv">scrapePostElement = </span><span class="nf">(post$) -&gt;</span>
      <span class="k">if</span> <span class="nv">is_question = </span><span class="nx">post$</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s1">&#39;.question&#39;</span><span class="p">)</span>
        <span class="nv">post =</span>
          <span class="nv">post_id: </span><span class="o">+</span><span class="nx">post$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;questionid&#39;</span><span class="p">)</span>
          <span class="nv">post_type: </span><span class="s1">&#39;question&#39;</span>
      <span class="k">else</span>
        <span class="nv">post =</span>
          <span class="nv">post_id: </span><span class="o">+</span><span class="nx">post$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;answerid&#39;</span><span class="p">)</span>
          <span class="nv">post_type: </span><span class="s1">&#39;answer&#39;</span>
          <span class="nv">is_accepted: </span><span class="nx">post$</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.vote-accepted-on&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">isnt</span> <span class="mi">0</span>
      
      <span class="nv">post.body = </span><span class="nx">$</span><span class="p">.</span><span class="nx">trim</span> <span class="nx">post$</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.post-text&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()</span>
      <span class="nv">post.score = </span><span class="o">+</span><span class="nx">post$</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.vote-count-post&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span>
      <span class="nv">post.deleted = </span><span class="nx">post$</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s1">&#39;.deleted-question, .deleted-answer&#39;</span><span class="p">)</span>
      
      <span class="nv">sigs = </span><span class="nx">post$</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.post-signature&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">sigs</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">2</span>
        <span class="p">[</span><span class="nx">editorSig</span><span class="p">,</span> <span class="nx">ownerSig</span><span class="p">]</span> <span class="o">=</span> <span class="nx">sigs</span>
      <span class="k">else</span>
        <span class="nv">editorSig = </span><span class="kc">null</span>
        <span class="p">[</span><span class="nx">ownerSig</span><span class="p">]</span> <span class="o">=</span> <span class="nx">sigs</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">communityOwnage</span><span class="nv">$ = </span><span class="nx">post$</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.community-wiki&#39;</span><span class="p">)).</span><span class="nx">length</span>
        <span class="nv">post.community_owned_date_s = </span><span class="nx">communityOwnage$</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/as of ([^\.]+)./</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">not</span> <span class="nx">communityOwnage$</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">and</span> <span class="nx">ownerSig</span><span class="o">?</span> <span class="o">and</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.user-details a&#39;</span><span class="p">,</span> <span class="nx">ownerSig</span><span class="p">).</span><span class="nx">length</span>
          <span class="nv">post.owner =</span>
            <span class="nv">user_id: </span><span class="o">+</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.user-details a&#39;</span><span class="p">,</span> <span class="nx">ownerSig</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\//g</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="nv">display_name: </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.user-details a&#39;</span><span class="p">,</span> <span class="nx">ownerSig</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span>
            <span class="nv">reputation: </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.reputation-score&#39;</span><span class="p">,</span> <span class="nx">ownerSig</span><span class="p">).</span><span class="nx">text</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nv">profile_image: </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.user-gravatar32 img&#39;</span><span class="p">,</span> <span class="nx">ownerSig</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">not</span> <span class="nx">communityOwnage$</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">and</span> <span class="nx">editorSig</span><span class="o">?</span> <span class="o">and</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.user-details a&#39;</span><span class="p">,</span> <span class="nx">editorSig</span><span class="p">).</span><span class="nx">length</span>
          <span class="nv">post.last_editor =</span>
            <span class="nv">user_id: </span><span class="o">+</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.user-details a&#39;</span><span class="p">,</span> <span class="nx">editorSig</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\//g</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="nv">display_name: </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.user-details a&#39;</span><span class="p">,</span> <span class="nx">editorSig</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span>
            <span class="nv">reputation: </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.reputation-score&#39;</span><span class="p">,</span> <span class="nx">editorSig</span><span class="p">).</span><span class="nx">text</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nv">profile_image: </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.user-gravatar32 img&#39;</span><span class="p">,</span> <span class="nx">editorSig</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span>
      
      <span class="k">if</span> <span class="nx">editorSig</span><span class="o">?</span> <span class="o">and</span> <span class="p">(</span><span class="nx">editTime</span><span class="nv">$ = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.relativetime&#39;</span><span class="p">,</span> <span class="nx">editorSig</span><span class="p">)).</span><span class="nx">length</span>
        <span class="nv">post.last_edit_date_s = </span><span class="nx">editTime$</span><span class="p">.</span><span class="nx">text</span><span class="p">()</span>
        <span class="nv">post.last_edit_date_z = </span><span class="nx">editTime$</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
      
      <span class="k">if</span> <span class="nx">ownerSig</span><span class="o">?</span> <span class="o">and</span> <span class="p">(</span><span class="nx">creationTime</span><span class="nv">$ = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.relativetime&#39;</span><span class="p">,</span> <span class="nx">ownerSig</span><span class="p">)).</span><span class="nx">length</span>
        <span class="nv">post.creation_date_s = </span><span class="nx">creationTime$</span><span class="p">.</span><span class="nx">text</span><span class="p">()</span>
        <span class="nv">post.creation_date_z = </span><span class="nx">creationTime$</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
    
      <span class="nx">post</span>
  
    <span class="nv">getQuestionDocuments: </span><span class="nf">(questionid) -&gt;</span>
      <span class="nx">@ajax</span><span class="p">(</span><span class="s2">&quot;/questions/#{questionid}&quot;</span><span class="p">).</span><span class="nx">pipe</span> <span class="p">(</span><span class="nx">firstSource</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">firstPage</span><span class="nv">$ = </span><span class="nx">$</span><span class="p">(</span><span class="nx">makeDocument</span><span class="p">(</span><span class="nx">firstSource</span><span class="p">))</span>
      </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>if there are multiple pages, request 'em all.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">lastPageNav</span><span class="nv">$ = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.page-numbers:not(.next)&#39;</span><span class="p">).</span><span class="nx">last</span><span class="p">()</span>
          <span class="nv">pageCount = </span><span class="o">+</span><span class="nx">lastPageNav$</span><span class="p">.</span><span class="nx">text</span><span class="p">()</span>
        
          <span class="nx">$</span><span class="p">.</span><span class="k">when</span><span class="p">(</span><span class="nx">firstPage$</span><span class="p">,</span> <span class="p">(</span><span class="k">if</span> <span class="nx">pageCount</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">then</span> <span class="p">(</span><span class="k">for</span> <span class="nx">pageNumber</span> <span class="k">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">..</span><span class="nx">pageCount</span><span class="p">]</span>
            <span class="nx">@ajax</span><span class="p">(</span><span class="s2">&quot;/questions/#{questionid}?page=#{pageNumber}&amp;noredirect=1&amp;answertab=votes&quot;</span><span class="p">).</span><span class="nx">pipe</span> <span class="nf">(source) -&gt;</span>
              <span class="nx">$</span><span class="p">(</span><span class="nx">makeDocument</span><span class="p">(</span><span class="nx">source</span><span class="p">))</span>
          <span class="p">)</span> <span class="k">else</span> <span class="p">[])...).</span><span class="nx">pipe</span> <span class="nf">(pages...) -&gt;</span> <span class="nx">pages</span>
        <span class="k">else</span>
          <span class="p">[</span><span class="nx">firstPage$</span><span class="p">]</span>
  
    <span class="nv">getPostSource: </span><span class="nf">(postid, revisionguid = null) -&gt;</span>
      <span class="nx">@ajax</span><span class="p">(</span><span class="s2">&quot;/posts/#{postid}/edit#{if revisionguid then &quot;</span><span class="o">/</span><span class="c1">#{revisionguid}&quot; else &#39;&#39;}&quot;).pipe (editPageSource) =&gt;</span>
        <span class="nx">sourcePage</span><span class="nv">$ = </span><span class="nx">$</span><span class="p">(</span><span class="nx">makeDocument</span><span class="p">(</span><span class="nx">editPageSource</span><span class="p">))</span>
        <span class="nv">postSource =</span>
          <span class="nv">title: </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;[name=title]&#39;</span><span class="p">,</span> <span class="nx">sourcePage$</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
          <span class="nv">body: </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;[name=post-text]&#39;</span><span class="p">,</span> <span class="nx">sourcePage$</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
    
    <span class="nv">getPostComments: </span><span class="nf">(postid) -&gt;</span>
      <span class="nx">@ajax</span><span class="p">(</span><span class="s2">&quot;/posts/#{postid}/comments&quot;</span><span class="p">).</span><span class="nx">pipe</span> <span class="p">(</span><span class="nx">commentsSource</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">commentPage</span><span class="nv">$ = </span><span class="nx">$</span><span class="p">(</span><span class="nx">makeDocument</span><span class="p">(</span><span class="s2">&quot;&lt;body&gt;&lt;table&gt;#{commentsSource}&lt;/table&gt;&lt;/body&gt;&quot;</span><span class="p">))</span>
        <span class="nv">postComments = </span><span class="p">[]</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.comment&#39;</span><span class="p">,</span> <span class="nx">commentPage$</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span>
          <span class="nx">postComments</span><span class="p">.</span><span class="nx">push</span>
            <span class="nv">comment_id: </span><span class="nx">$</span><span class="p">(</span><span class="err">@</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="nv">score: </span><span class="o">+</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.comment-score&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">).</span><span class="nx">text</span><span class="p">())</span> <span class="o">?</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nv">body: </span><span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.comment-copy&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">).</span><span class="nx">html</span><span class="p">())</span>
            <span class="nv">user_id: </span><span class="o">+</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a.comment-user&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\//g</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="nv">display_name: </span><span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a.comment-user&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">text</span><span class="p">()</span>
        <span class="nx">postComments</span>
    
    <span class="nv">getPostVoteCount: </span><span class="nf">(postid) -&gt;</span>
      <span class="nx">@throttledAjax</span><span class="p">(</span><span class="s1">&#39;get-vote-count&#39;</span><span class="p">,</span> <span class="mi">1400</span><span class="p">,</span> <span class="s2">&quot;/posts/#{postid}/vote-counts&quot;</span><span class="p">,</span> <span class="nv">dataType: </span><span class="s1">&#39;json&#39;</span><span class="p">).</span><span class="nx">pipe</span> <span class="p">(</span><span class="nx">voteCounts</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="p">(</span><span class="nv">up: </span><span class="o">+</span><span class="nx">voteCounts</span><span class="p">.</span><span class="nx">up</span><span class="p">,</span> <span class="nv">down: </span><span class="o">+</span><span class="nx">voteCounts</span><span class="p">.</span><span class="nx">down</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>be nice: wrap $.ajax to add our throttle and header.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">ajax: </span><span class="nf">(url, options = {}) -&gt;</span>
      <span class="nx">@throttledAjax</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">options</span>
    
    <span class="nv">throttledAjax: </span><span class="nf">(throttleName, throttleDelay, url, options = {}) -&gt;</span>
      <span class="nv">throttle = </span><span class="nx">@throttles</span><span class="p">[</span><span class="nx">throttleName</span><span class="p">]</span> <span class="o">?=</span>  <span class="nx">makeThrottle</span><span class="p">(</span><span class="nx">throttleDelay</span><span class="p">)(</span><span class="nf">(f) -&gt;</span> <span class="nx">f</span><span class="p">())</span>
      <span class="nx">throttle</span> <span class="o">-&gt;</span>
        <span class="nv">existingBeforeSend = </span><span class="nx">options</span><span class="p">.</span><span class="nx">beforeSend</span><span class="p">;</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">cache</span> <span class="o">?=</span> <span class="kc">true</span>
        <span class="nv">options.beforeSend = </span><span class="nf">(request) -&gt;</span>
          <span class="nx">request</span><span class="p">.</span><span class="nx">setRequestHeader</span> <span class="s1">&#39;X-StackScraper-Version&#39;</span><span class="p">,</span> <span class="nx">manifest</span><span class="p">.</span><span class="nx">version</span>
          <span class="k">return</span> <span class="nx">existingBeforeSend</span><span class="o">?</span><span class="p">.</span><span class="nx">apply</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
 
    <span class="nv">encodeHTMLText: </span><span class="nf">(text) -&gt;</span>
      <span class="nb">String</span><span class="p">(</span><span class="nx">text</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;/g</span><span class="p">,</span> <span class="s1">&#39;&amp;amp;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;/g</span><span class="p">,</span> <span class="s1">&#39;&amp;lt;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;/g</span><span class="p">,</span> <span class="s1">&#39;&amp;gt;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;/g</span><span class="p">,</span> <span class="s1">&#39;&amp;gt;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span> <span class="s1">&#39;&amp;quot;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span> <span class="s1">&#39;&amp;#39;&#39;</span><span class="p">)</span>
  
    <span class="nv">renderPost: </span><span class="nf">(post) -&gt;</span>
      <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      &lt;div class=&quot;</span><span class="c1">#{@encodeHTMLText(post.post_type)} post&quot; id=&quot;#{@encodeHTMLText(post.post_id)}&quot;&gt;</span>
        <span class="c1">#{if post.title?</span>
          <span class="s2">&quot;&lt;h1&gt;#{@encodeHTMLText(post.title)}&lt;/h1&gt;&quot;</span>
        <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">&quot;metrics&quot;</span><span class="o">&gt;</span>
          <span class="c1">#{if post.score?</span>
            <span class="s2">&quot;&lt;span class=\&quot;value\&quot;&gt;#{@encodeHTMLText(post.score)}&lt;/span&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;span class=\&quot;unit\&quot;&gt;votes&lt;/span&gt;&quot;</span>
          <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
          <span class="c1">#{if post.view_count?</span>
            <span class="s2">&quot;&lt;br&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;span class=\&quot;value\&quot;&gt;#{@encodeHTMLText(post.view_count)}&lt;/span&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;span class=\&quot;unit\&quot;&gt;views&lt;/span&gt;&quot;</span>
          <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
          <span class="c1">#{if post.comments?.length</span>
            <span class="s2">&quot;&lt;br&gt;&lt;a href=\&quot;javascript:void(location.hash = &#39;#{@encodeHTMLText(post.post_id)}-comments&#39;)\&quot; style=\&quot;text-decoration: none;\&quot;&gt;&lt;span class=\&quot;value\&quot;&gt;#{@encodeHTMLText(post.comments.length)}&lt;/span&gt;&lt;span class=\&quot;unit\&quot; style=\&quot;font-size: 75%;\&quot;&gt;comments&lt;/span&gt;&lt;/a&gt;&quot;</span>
          <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">&quot;body&quot;</span><span class="o">&gt;</span>
            <span class="c1">#{post.body}</span>
          <span class="o">&lt;</span><span class="err">/div&gt;</span>
        
          <span class="c1">#{@renderAttributionBox(post.creation_date_s, post.owner, &#39;asked&#39;)}</span>
        
          <span class="c1">#{@renderAttributionBox(post.last_edit_date_s, post.last_editor, &#39;edited&#39;)}</span>
        
          <span class="c1">#{if post.tags?</span>
            <span class="s2">&quot;&lt;ul class=\&quot;tags\&quot;&gt;&quot;</span> <span class="o">+</span>
              <span class="p">(</span><span class="s2">&quot;&lt;li&gt;&lt;a href=\&quot;/tags/#{@encodeHTMLText tag}\&quot;&gt;#{@encodeHTMLText tag}&lt;/a&gt;&lt;/li&gt;&quot;</span> <span class="k">for</span> <span class="nx">tag</span> <span class="k">in</span> <span class="nx">post</span><span class="p">.</span><span class="nx">tags</span>
              <span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;/ul&gt;&quot;</span>
          <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
        
          <span class="o">&lt;</span><span class="nx">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">&quot;clear&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>
      
          <span class="c1">#{@renderPostComments post}</span>
      
          <span class="c1">#{if post.post_type is &#39;question&#39;</span>
              <span class="s2">&quot;&lt;div class=\&quot;source-header\&quot;&gt;&quot;</span> <span class="o">+</span>
                <span class="s2">&quot;This was &lt;a href=\&quot;/q/#{post.post_id}\&quot;&gt;originally posted&lt;/a&gt; on Stack Exchange#{if post.deleted then &#39;, but it has been deleted&#39; else &#39;&#39;}.&quot;</span> <span class="o">+</span>
              <span class="s2">&quot;&lt;/div&gt;&quot;</span>
          <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;  </span>
    
      <span class="o">&lt;</span><span class="nx">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">&quot;clear&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>
      <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  </span>
<span class="s2">    renderAttributionBox: (date_s, shallow_user, verb) -&gt;</span>
<span class="s2">      if date_s? then &quot;&quot;&quot;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">&quot;attribution&quot;</span><span class="o">&gt;</span>
          <span class="c1">#{verb} #{if shallow_user? and shallow_user.profile_image? and shallow_user.user_id? # TODO: degrade more gracefully.</span>
            <span class="s2">&quot;by &lt;a href=\&quot;/u/#{@encodeHTMLText(shallow_user.user_id)}\&quot;&gt;#{@encodeHTMLText(shallow_user.display_name)}&lt;img src=\&quot;#{@encodeHTMLText(shallow_user.profile_image)}\&quot; alt=\&quot;\&quot; /&gt;&lt;/a&gt;&lt;br&gt;&quot;</span>
          <span class="k">else</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">}</span>
          <span class="c1">#{@encodeHTMLText(date_s)}</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
      <span class="s2">&quot;&quot;&quot; else &#39;&#39;</span>
<span class="s2">  </span>
<span class="s2">    renderPostComments: (post) -&gt;</span>
<span class="s2">      if post.comments?.length then &quot;&quot;&quot;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">&quot;comments&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;#{@encodeHTMLText post.post_id}-comments&quot;</span><span class="o">&gt;</span>
          <span class="c1">#{(for comment in post.comments</span>
              <span class="s2">&quot;&lt;div class=\&quot;comment\&quot;&gt;&quot;</span> <span class="o">+</span>
                <span class="s2">&quot;&lt;span class=\&quot;score\&quot;&gt;[#{comment.score}]&lt;/span&gt; &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;&lt;span class=\&quot;author\&quot;&gt;&lt;a href=\&quot;/u/#{comment.user_id}\&quot;&gt;#{@encodeHTMLText comment.display_name}&lt;/a&gt;:&lt;/span&gt; &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;&lt;span class=\&quot;body\&quot;&gt;#{comment.body}&lt;/span&gt;&quot;</span> <span class="o">+</span>
              <span class="s2">&quot;&lt;/div&gt;&quot;</span>
          <span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)}</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
      <span class="s2">&quot;&quot;&quot; else &#39;&#39;</span>
<span class="s2">  </span>
<span class="s2">    renderQuestionPage: (question, base = (&#39;http://&#39; + window?.location?.host)) -&gt;</span>
<span class="s2">      &quot;&quot;&quot;</span><span class="o">&lt;!</span><span class="nx">doctype</span> <span class="nx">html</span><span class="o">&gt;&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;generator&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;StackScraper #{manifest.version}&quot;</span> <span class="o">/&gt;</span> 
    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span>
      <span class="c1">#{@encodeHTMLText(question.title)}</span>
    <span class="o">&lt;</span><span class="err">/title&gt;</span>
    <span class="c1">#{if base then &quot;&lt;base href=\&quot;#{@encodeHTMLText(base)}\&quot; /&gt;&quot; else &#39;&#39;}</span>
    <span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
      <span class="nx">html</span> <span class="p">{</span>
        <span class="nv">background: </span><span class="c1">#D8D8D8;</span>
      <span class="p">}</span>
    
      <span class="nx">body</span> <span class="p">{</span>
        <span class="nv">font: </span><span class="mi">14</span><span class="nx">px</span> <span class="nx">sans</span><span class="o">-</span><span class="nx">serif</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="nx">a</span><span class="p">,</span> <span class="nx">a</span><span class="o">:</span><span class="nx">visited</span> <span class="p">{</span>
        <span class="nv">color: </span><span class="c1">#226;</span>
      <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">wrapper</span> <span class="p">{</span>
        <span class="nv">width: </span><span class="mi">735</span><span class="nx">px</span><span class="p">;</span>
        <span class="nv">margin: </span><span class="mi">1</span><span class="nx">em</span> <span class="nx">auto</span><span class="p">;</span>
        <span class="nv">background: </span><span class="nx">white</span><span class="p">;</span>
        <span class="nv">padding: </span><span class="mi">1</span><span class="nx">em</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="nx">h1</span><span class="p">,</span><span class="nx">h2</span><span class="p">,</span> <span class="nx">h3</span><span class="p">,</span> <span class="nx">h4</span> <span class="p">{</span>
        <span class="nx">padding</span><span class="o">-</span><span class="nv">bottom: </span><span class="p">.</span><span class="mi">2</span><span class="nx">em</span><span class="p">;</span>
        <span class="nx">border</span><span class="o">-</span><span class="nv">bottom: </span><span class="mi">1</span><span class="nx">px</span> <span class="nx">solid</span> <span class="nx">black</span><span class="p">;</span>
        <span class="nx">margin</span><span class="o">-</span><span class="nv">top: </span><span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="nx">h1</span> <span class="p">{</span>
        <span class="nx">font</span><span class="o">-</span><span class="nv">size: </span><span class="mf">1.6</span><span class="nx">em</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">h2</span> <span class="p">{</span>
        <span class="nx">font</span><span class="o">-</span><span class="nv">size: </span><span class="mf">1.4</span><span class="nx">em</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">h3</span> <span class="p">{</span>
        <span class="nx">font</span><span class="o">-</span><span class="nv">size: </span><span class="mf">1.2</span><span class="nx">em</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="nx">h2</span><span class="p">.</span><span class="nx">answers</span> <span class="p">{</span>
        <span class="nx">border</span><span class="o">-</span><span class="nv">bottom: </span><span class="mi">1</span><span class="nx">px</span> <span class="nx">solid</span> <span class="nx">black</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">implied</span><span class="o">-</span><span class="k">by</span><span class="o">-</span><span class="nx">style</span> <span class="p">{</span>
        <span class="nv">display: </span><span class="nx">none</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">source</span><span class="o">-</span><span class="nx">header</span> <span class="p">{</span>
        <span class="nv">display: </span><span class="nx">block</span><span class="p">;</span>
        <span class="nx">background</span><span class="o">-</span><span class="nv">color: </span><span class="c1">#EEE;</span>
        <span class="nv">padding: </span><span class="mi">1</span><span class="nx">em</span> <span class="mi">1</span><span class="nx">em</span><span class="p">;</span>
        <span class="nx">font</span><span class="o">-</span><span class="nv">size: </span><span class="mf">1.3</span><span class="nx">em</span><span class="p">;</span>
        <span class="nx">font</span><span class="o">-</span><span class="nv">weight: </span><span class="nx">bold</span><span class="p">;</span>
        <span class="nv">color: </span><span class="nx">black</span><span class="p">;</span>
        <span class="nx">text</span><span class="o">-</span><span class="nv">align: </span><span class="nx">left</span><span class="p">;</span>
        <span class="nv">margin: </span><span class="mf">0.5</span><span class="nx">em</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">text</span><span class="o">-</span><span class="nv">align: </span><span class="nx">center</span><span class="p">;</span>
      <span class="p">}</span>
    
      
        <span class="p">.</span><span class="nx">source</span><span class="o">-</span><span class="nx">header</span> <span class="nx">a</span><span class="p">,</span> <span class="p">.</span><span class="nx">source</span><span class="o">-</span><span class="nx">header</span> <span class="nx">a</span><span class="o">:</span><span class="nx">visited</span> <span class="p">{</span>
          <span class="nv">color: </span><span class="nx">black</span><span class="p">;</span>
        <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">metrics</span> <span class="p">{</span>
        <span class="nv">float: </span><span class="nx">left</span><span class="p">;</span>
        <span class="nx">text</span><span class="o">-</span><span class="nv">align: </span><span class="nx">center</span><span class="p">;</span>
        <span class="nv">width: </span><span class="mi">58</span><span class="nx">px</span><span class="p">;</span>
        <span class="nv">margin: </span><span class="mi">0</span><span class="nx">px</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nv">padding: </span><span class="mi">5</span><span class="nx">px</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">border</span><span class="o">-</span><span class="nv">right: </span><span class="mi">1</span><span class="nx">px</span> <span class="nx">solid</span> <span class="c1">#DDD;</span>
      <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">post</span> <span class="o">+</span> <span class="p">.</span><span class="nx">post</span> <span class="p">{</span>
          <span class="nx">border</span><span class="o">-</span><span class="nv">top: </span><span class="mi">1</span><span class="nx">px</span> <span class="nx">solid</span> <span class="c1">#888;</span>
          <span class="nx">padding</span><span class="o">-</span><span class="nv">top: </span><span class="mi">1</span><span class="nx">em</span><span class="p">;</span>
          <span class="nx">margin</span><span class="o">-</span><span class="nv">top: </span><span class="mi">1</span><span class="nx">em</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">post</span> <span class="o">+</span> <span class="p">.</span><span class="nx">clear</span> <span class="o">+</span> <span class="p">.</span><span class="nx">post</span> <span class="p">{</span>
          <span class="nx">border</span><span class="o">-</span><span class="nv">top: </span><span class="mi">1</span><span class="nx">px</span> <span class="nx">solid</span> <span class="c1">#888;</span>
          <span class="nx">padding</span><span class="o">-</span><span class="nv">top: </span><span class="mi">1</span><span class="nx">em</span><span class="p">;</span>
          <span class="nx">margin</span><span class="o">-</span><span class="nv">top: </span><span class="mi">1</span><span class="nx">em</span><span class="p">;</span>
      <span class="p">}</span>
      
        <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">metrics</span> <span class="p">.</span><span class="nx">value</span> <span class="p">{</span>
          <span class="nv">display: </span><span class="nx">block</span><span class="p">;</span>
          <span class="nx">font</span><span class="o">-</span><span class="nv">weight: </span><span class="nx">bold</span><span class="p">;</span>
          <span class="nx">font</span><span class="o">-</span><span class="nv">size: </span><span class="mf">1.3</span><span class="nx">em</span><span class="p">;</span>
          <span class="nv">margin: </span><span class="mi">3</span><span class="nx">px</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">metrics</span> <span class="p">.</span><span class="nx">unit</span> <span class="p">{</span>
          <span class="nv">display: </span><span class="nx">block</span><span class="p">;</span>
          <span class="nv">opacity: </span><span class="mf">0.5</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">metrics</span> <span class="p">.</span><span class="nx">annotation</span> <span class="p">{</span>
          <span class="nv">display: </span><span class="nx">block</span><span class="p">;</span>
          <span class="nx">font</span><span class="o">-</span><span class="nv">weight: </span><span class="nx">bold</span><span class="p">;</span>
          <span class="nx">font</span><span class="o">-</span><span class="nv">size: </span><span class="mf">0.8</span><span class="nx">em</span><span class="p">;</span>
          <span class="nv">opacity: </span><span class="mf">0.75</span><span class="p">;</span>
          <span class="nv">margin: </span><span class="mi">5</span><span class="nx">px</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">tags</span> <span class="p">{</span>
        <span class="nx">list</span><span class="o">-</span><span class="nx">style</span><span class="o">-</span><span class="nv">type: </span><span class="nx">none</span><span class="p">;</span>
        <span class="nv">padding: </span><span class="mi">0</span><span class="p">;</span>
        <span class="nx">line</span><span class="o">-</span><span class="nv">height: </span><span class="mf">1.75</span><span class="nx">em</span><span class="p">;</span>
      <span class="p">}</span>
      
        <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">tags</span> <span class="nx">li</span> <span class="p">{</span>
          <span class="nv">display: </span><span class="nx">inline</span><span class="p">;</span>
          <span class="nv">padding: </span><span class="p">.</span><span class="mi">3</span><span class="nx">em</span> <span class="p">.</span><span class="mi">5</span><span class="nx">em</span><span class="p">;</span>
          <span class="nv">margin: </span><span class="p">.</span><span class="mi">2</span><span class="nx">em</span><span class="p">;</span>
          <span class="nv">border: </span><span class="mi">1</span><span class="nx">px</span> <span class="nx">solid</span> <span class="c1">#888;</span>
          <span class="nv">background: </span><span class="c1">#F8F8F4;</span>
          <span class="nx">font</span><span class="o">-</span><span class="nv">size: </span><span class="p">.</span><span class="mi">75</span><span class="nx">em</span><span class="p">;</span>
        <span class="p">}</span>
          <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">tags</span> <span class="nx">li</span> <span class="nx">a</span> <span class="p">{</span>
            <span class="nv">color: </span><span class="nx">inherit</span><span class="p">;</span>
            <span class="nx">text</span><span class="o">-</span><span class="nv">decoration: </span><span class="nx">inherit</span><span class="p">;</span>
          <span class="p">}</span>
        
        <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">body</span> <span class="p">{</span>
          <span class="nx">line</span><span class="o">-</span><span class="nv">height: </span><span class="mf">1.3</span><span class="nx">em</span><span class="p">;</span>
        <span class="p">}</span>
      
        <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">body</span> <span class="nx">p</span><span class="p">,</span> <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">body</span> <span class="nx">pre</span> <span class="p">{</span>
          <span class="nx">margin</span><span class="o">-</span><span class="nv">top: </span><span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">attribution</span> <span class="p">{</span>  
        <span class="nx">font</span><span class="o">-</span><span class="nv">size: </span><span class="mi">11</span><span class="nx">px</span><span class="p">;</span>
        <span class="nv">height: </span><span class="mi">4</span><span class="nx">em</span><span class="p">;</span>
        <span class="nv">float: </span><span class="nx">right</span><span class="p">;</span>
        <span class="nv">width: </span><span class="mi">160</span><span class="nx">px</span><span class="p">;</span>
        <span class="nv">border: </span><span class="mi">1</span><span class="nx">px</span> <span class="nx">solid</span> <span class="c1">#E8E8E4;</span>
        <span class="nx">margin</span><span class="o">-</span><span class="nv">left: </span><span class="mi">1</span><span class="nx">em</span><span class="p">;</span>
        <span class="nv">padding: </span><span class="mi">4</span><span class="nx">px</span><span class="p">;</span>
        <span class="nx">padding</span><span class="o">-</span><span class="nv">bottom: </span><span class="mi">8</span><span class="nx">px</span><span class="p">;</span>
        <span class="nv">background: </span><span class="c1">#F8F8F4;</span>
        <span class="nv">position: </span><span class="nx">relative</span><span class="p">;</span>
        <span class="nx">line</span><span class="o">-</span><span class="nv">height: </span><span class="mf">1.6</span><span class="nx">em</span><span class="p">;</span>
        <span class="nx">margin</span><span class="o">-</span><span class="nv">bottom: </span><span class="mi">8</span><span class="nx">px</span><span class="p">;</span>
      <span class="p">}</span>
      
        <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">attribution</span> <span class="nx">img</span> <span class="p">{</span>
          <span class="nv">border: </span><span class="mi">1</span><span class="nx">px</span> <span class="nx">solid</span> <span class="c1">#E8E8E4;</span>
          <span class="nx">border</span><span class="o">-</span><span class="nv">right: </span><span class="mi">0</span><span class="p">;</span>
          <span class="nx">border</span><span class="o">-</span><span class="nv">bottom: </span><span class="mi">0</span><span class="p">;</span>
          <span class="nv">float: </span><span class="nx">right</span><span class="p">;</span>
          <span class="nv">position: </span><span class="nx">absolute</span><span class="p">;</span>
          <span class="nv">bottom: </span><span class="mi">0</span><span class="nx">px</span><span class="p">;</span>
          <span class="nv">right: </span><span class="mi">0</span><span class="nx">px</span><span class="p">;</span>
        <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">col</span> <span class="p">{</span>
        <span class="nv">float: </span><span class="nx">right</span><span class="p">;</span>
        <span class="nv">width: </span><span class="mi">665</span><span class="nx">px</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="p">.</span><span class="nx">post</span> <span class="p">.</span><span class="nx">col</span> <span class="nx">img</span> <span class="p">{</span>
        <span class="nx">max</span><span class="o">-</span><span class="nv">width: </span><span class="mi">665</span><span class="nx">px</span><span class="p">;</span>
      <span class="p">}</span>
    
      <span class="nx">blockquote</span> <span class="p">{</span>
        <span class="nv">margin: </span><span class="p">.</span><span class="mi">5</span><span class="nx">em</span> <span class="p">.</span><span class="mi">25</span><span class="nx">em</span><span class="p">;</span>
        <span class="nx">margin</span><span class="o">-</span><span class="nv">bottom: </span><span class="p">.</span><span class="mi">75</span><span class="nx">em</span><span class="p">;</span>
        <span class="nv">padding: </span><span class="mi">1</span><span class="nx">em</span><span class="p">;</span>
        <span class="nx">padding</span><span class="o">-</span><span class="nv">bottom: </span><span class="mf">0.5</span><span class="nx">em</span><span class="p">;</span>
        <span class="nv">background: </span><span class="c1">#EEE;</span>
      <span class="p">}</span>
      
      <span class="nx">pre</span> <span class="p">{</span>
        <span class="nv">background: </span><span class="c1">#EEE;</span>
        <span class="nv">padding: </span><span class="mi">8</span><span class="nx">px</span> <span class="mi">8</span><span class="nx">px</span><span class="p">;</span>
        <span class="nx">margin</span><span class="o">-</span><span class="nx">bottom</span><span class="p">;</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;</span>
        <span class="nv">font: </span><span class="mi">100</span><span class="o">%</span> <span class="nx">Menlo</span><span class="p">,</span> <span class="nx">Monaco</span><span class="p">,</span> <span class="nx">Consolas</span><span class="p">,</span> <span class="s2">&quot;Lucida Console&quot;</span><span class="p">,</span> <span class="nx">monospace</span><span class="p">;</span>
        <span class="nx">line</span><span class="o">-</span><span class="nv">height: </span><span class="mf">1.3</span><span class="nx">em</span><span class="p">;</span>
        <span class="nx">overflow</span><span class="o">-</span><span class="nv">x: </span><span class="nx">scroll</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">footer</span> <span class="p">{</span>
        <span class="nx">font</span><span class="o">-</span><span class="nv">size: </span><span class="mf">0.8</span><span class="nx">em</span><span class="p">;</span>
        <span class="nx">text</span><span class="o">-</span><span class="nv">align: </span><span class="nx">center</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">footer</span> <span class="nx">a</span> <span class="p">{</span>
        <span class="nx">text</span><span class="o">-</span><span class="nv">decoration: </span><span class="nx">none</span><span class="p">;</span>
        <span class="nv">color: </span><span class="c1">#222;</span>
      <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">footer</span> <span class="nx">a</span><span class="o">:</span><span class="nx">hover</span> <span class="p">{</span>
        <span class="nx">text</span><span class="o">-</span><span class="nv">decoration: </span><span class="nx">underline</span><span class="p">;</span>
      <span class="p">}</span>
    
      <span class="p">.</span><span class="nx">comments</span> <span class="p">{</span>
        <span class="nv">display: </span><span class="nx">none</span><span class="p">;</span>
      <span class="p">}</span>
    
      <span class="p">.</span><span class="nx">comments</span><span class="o">:</span><span class="nx">target</span> <span class="p">{</span>
        <span class="nv">display: </span><span class="nx">block</span><span class="p">;</span>
      <span class="p">}</span>
    
      <span class="p">.</span><span class="nx">comments</span> <span class="p">.</span><span class="nx">comment</span> <span class="p">{</span>
        <span class="nv">padding: </span><span class="p">.</span><span class="mi">125</span><span class="nx">em</span><span class="p">;</span>
        <span class="nv">border: </span><span class="p">.</span><span class="mi">125</span><span class="nx">em</span> <span class="nx">solid</span> <span class="c1">#EEE;</span>
        <span class="nv">background: </span><span class="c1">#F8F8F8;</span>
      <span class="p">}</span>
    
      <span class="p">.</span><span class="nx">comments</span> <span class="p">.</span><span class="nx">comment</span> <span class="p">.</span><span class="nx">score</span><span class="p">,</span> <span class="p">.</span><span class="nx">comments</span> <span class="p">.</span><span class="nx">comment</span> <span class="p">.</span><span class="nx">author</span> <span class="p">{</span>
        <span class="nx">font</span><span class="o">-</span><span class="nv">weight: </span><span class="nx">bold</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="p">.</span><span class="nx">clear</span> <span class="p">{</span> <span class="nv">clear: </span><span class="nx">both</span><span class="p">;</span> <span class="p">}</span>
    <span class="o">&lt;</span><span class="err">/style&gt;</span>
  <span class="o">&lt;</span><span class="err">/head&gt;</span>
  <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">&quot;wrapper&quot;</span><span class="o">&gt;</span>
      <span class="c1">#{@renderPost(question)}</span>
    
      <span class="o">&lt;</span><span class="nx">h2</span> <span class="k">class</span><span class="o">=</span><span class="s2">&quot;answers&quot;</span><span class="o">&gt;</span>
        <span class="c1">#{@encodeHTMLText(question.answers.length)} Answers</span>
      <span class="o">&lt;</span><span class="err">/h2&gt;</span>
    
      <span class="c1">#{(@renderPost(answer) for answer in question.answers).join(&#39;\n&#39;)}</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">&quot;footer&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="nx">exported</span> <span class="nx">using</span> <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#{@encodeHTMLText(manifest.homepage_url)}&quot;</span><span class="o">&gt;</span><span class="nx">StackScraper</span><span class="o">&lt;</span><span class="err">/a&gt;&lt;/a&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
  <span class="nx">var</span> <span class="nv">QUESTION =</span>
  <span class="err">// BEGIN QUESTION JSON</span>
  <span class="c1">#{JSON.stringify question}</span>
  <span class="o">/</span><span class="err">/ END QUESTION JSON</span>
  <span class="p">;</span>
  <span class="o">&lt;</span><span class="err">/script&gt;</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
  <span class="o">&lt;</span><span class="err">/html&gt;&quot;&quot;&quot;</span>
  
  <span class="nx">do</span> <span class="nx">main</span>

<span class="k">if</span> <span class="nx">exports</span><span class="o">?</span>
  <span class="nv">exports.manifest = </span><span class="nx">manifest</span>
  <span class="nv">exports.body = </span><span class="nx">body</span>
<span class="k">else</span> <span class="k">if</span> <span class="nb">document</span><span class="o">?</span> <span class="o">and</span> <span class="nx">location</span><span class="o">?</span>
  <span class="k">if</span> <span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/\/questions\/\d+/</span>
    <span class="nv">e = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s1">&#39;script&#39;</span>
    <span class="nv">e.textContent = </span><span class="s2">&quot;(#{body})(#{JSON.stringify manifest});&quot;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">e</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 